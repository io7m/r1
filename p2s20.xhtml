<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>io7m-r1 0.10.0 Documentation: 2.20. Spherical Lighting</title><link rel="stylesheet" type="text/css" href="jstructural-2.0.0-layout.css"/><link rel="stylesheet" type="text/css" href="jstructural-2.0.0-colour.css"/><link rel="stylesheet" type="text/css" href="documentation.css"/></head><body><div class="st200_body"><div class="brand">
  <div class="brand_left">
    <a href="http://io7m.com/">io7m</a>
  </div>
  <div class="brand_right">
    <a href="http://mvn.io7m.com/io7m-r1/">io7m-r1</a> 0.10.0
  </div>
</div><div class="st200_navbar st200_navbar_top"><table class="st200_navbar_table" summary="Navigation bar"><tr><td class="st200_navbar_prev_title_cell">2.19. Directional Lighting</td><td class="st200_navbar_up_title_cell">2. Design and Implementation</td><td class="st200_navbar_next_title_cell">2.21. Projective Lighting</td></tr><tr><td class="st200_navbar_prev_file_cell"><a href="p2s19.xhtml#st200_p2s19">Previous</a></td><td class="st200_navbar_up_file_cell"><a href="p2.xhtml#st200_p2">Up</a></td><td class="st200_navbar_next_file_cell"><a href="p2s21.xhtml#st200_p2s21">Next</a></td></tr></table><hr class="st200_hr"/></div><div class="st200_section_container"><div class="st200_section_title_number"><a id="st200_p2s20" href="#st200_p2s20">2.20</a></div><div class="st200_section_title">Spherical Lighting</div><ul class="st200_contents st200_section_contents_outer st200_section_contents"><li class="st200_contents_item st200_contents_item1 st200_contents_item_subsection"><a href="p2s20.xhtml#st200_p2s20ss1">2.20.1. Overview</a></li><li class="st200_contents_item st200_contents_item1 st200_contents_item_subsection"><a href="p2s20.xhtml#st200_p2s20ss2">2.20.2. Types</a></li><li class="st200_contents_item st200_contents_item1 st200_contents_item_subsection"><a href="p2s20.xhtml#st200_p2s20ss3">2.20.3. Attenuation</a></li><li class="st200_contents_item st200_contents_item1 st200_contents_item_subsection"><a href="p2s20.xhtml#st200_p2s20ss4">2.20.4. Application</a></li><li class="st200_contents_item st200_contents_item1 st200_contents_item_subsection"><a href="p2s20.xhtml#st200_p2s20ss5">2.20.5. Shadows</a></li></ul><div class="st200_subsection_container"><div class="st200_subsection_title_number"><a id="st200_p2s20ss1" href="#st200_p2s20ss1">2.20.1</a></div><div class="st200_subsection_title">Overview</div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss1pg1" href="#st200_p2s20ss1pg1">1</a></div><div class="st200_paragraph">
      A <span class="st200_term term">spherical light</span> in the 
      <span class="st200_term package">io7m-r1</span> package
      is a light that emits rays of light in all directions from
      a given <span class="st200_term term">origin</span> specified in
      <a class="st200_link" href="p2s3.xhtml#st200_p2s3ss5">eye space</a>
      up to a given maximum <span class="st200_term term">radius</span>.
    </div></div><div class="st200_formal_item"><div class="st200_formal_item_title"><a id="st200_p2s20ss1fo1" href="#st200_p2s20ss1fo1">2.20.1.1. Spherical lighting</a></div><img class="st200_image" alt="Spherical lighting" src="images/spherical_diagram.png"/></div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss1pg2" href="#st200_p2s20ss1pg2">2</a></div><div class="st200_paragraph">
      The term <span class="st200_term term">spherical</span> comes from the
      fact that the light has a defined radius. Most rendering systems
      instead use <span class="st200_term term">point</span> lights that 
      specify multiple <span class="st200_term term">attenuation</span> 
      constants to control how light is attenuated over distance. The
      problem with this approach is that it requires solving a quadratic
      equation to determine a minimum bounding sphere that can contain
      the light. Essentially, the programmer/artist is forced to determine 
      "at which radius does the contribution from this light effectively reach
      zero?". With spherical lights, the maximum radius is declared up
      front, and a single falloff value is used to determine the
      attenuation curve within that radius. This makes spherical
      lights more intuitive to use: The programmer/artist simply places a
      sphere within the scene and knows exactly from the radius which
      objects are lit by it. It also means that bounding light volumes
      can be trivially constructed from unit spheres by simply scaling
      those spheres by the light radius, when performing
      <a class="st200_link" href="p2s12.xhtml#st200_p2s12">deferred rendering</a>.
    </div></div></div><div class="st200_subsection_container"><div class="st200_subsection_title_number"><a id="st200_p2s20ss2" href="#st200_p2s20ss2">2.20.2</a></div><div class="st200_subsection_title">Types</div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss2pg1" href="#st200_p2s20ss2pg1">1</a></div><div class="st200_paragraph">
      Spherical lights are represented in the <span class="st200_term package">io7m-r1</span> 
      package by the following types:
    </div></div><div class="st200_formal_item"><div class="st200_formal_item_title"><a id="st200_p2s20ss2fo1" href="#st200_p2s20ss2fo1">2.20.2.1. Types</a></div><ul class="st200_list_unordered"><li class="st200_list_item">
          <a class="st200_link_external" href="apidocs/com/io7m/r1/kernel/types/KLightSphereWithoutShadow.html">KLightSphereWithoutShadow</a> -
          a spherical light that does not cast shadows.
        </li><li class="st200_list_item">
          <a class="st200_link_external" href="apidocs/com/io7m/r1/kernel/types/KLightSphereWithoutShadowDiffuseOnly.html">KLightSphereWithoutShadowDiffuseOnly</a> -
          a spherical light that does not cast shadows and does not cause specular highlights.
        </li><li class="st200_list_item">
          <a class="st200_link_external" href="apidocs/com/io7m/r1/kernel/types/KLightSphereTexturedCubeWithoutShadow.html">KLightSphereTexturedCubeWithoutShadow</a> -
          a spherical light that does not cast shadows, with an additional color term sampled from an associated cube map.
        </li></ul></div></div><div class="st200_subsection_container"><div class="st200_subsection_title_number"><a id="st200_p2s20ss3" href="#st200_p2s20ss3">2.20.3</a></div><div class="st200_subsection_title">Attenuation</div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss3pg1" href="#st200_p2s20ss3pg1">1</a></div><div class="st200_paragraph">
      The light supports <a class="st200_link" href="p2s18.xhtml#st200_p2s18ss4">attenuation</a> 
      using the <span class="st200_term term">radius</span> as the maximum range.
    </div></div></div><div class="st200_subsection_container"><div class="st200_subsection_title_number"><a id="st200_p2s20ss4" href="#st200_p2s20ss4">2.20.4</a></div><div class="st200_subsection_title">Application</div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss4pg1" href="#st200_p2s20ss4pg1">1</a></div><div class="st200_paragraph">
      The final light applied to the surface is given by <span class="st200_term function">spherical</span>
      [<a class="st200_link_external" href="haskell/Spherical.hs">Spherical.hs</a>], where
      <span class="st200_term variable">sr</span>, <span class="st200_term variable">sg</span>,
      <span class="st200_term variable">sb</span> are the red, green, and blue channels,
      respectively, of the surface being lit. The surface-to-light vector 
      <span class="st200_term variable">stl</span> is calculated by normalizing the
      negation of the difference between the the current eye space
      <span class="st200_term variable">surface_position</span> and the eye space
      origin of the light.
    </div></div><div class="st200_formal_item"><div class="st200_formal_item_title"><a id="st200_p2s20ss4fo1" href="#st200_p2s20ss4fo1">2.20.4.1. Spherical lighting (Application)</a></div><pre class="st200_verbatim">module Spherical where

import qualified Attenuation
import qualified Color4
import qualified Direction
import qualified LightDiffuse
import qualified LightSpecular
import qualified LightSpherical
import qualified Normal
import qualified Position3
import qualified Specular
import qualified Spaces
import qualified Vector3f
import qualified Vector4f

spherical :: Direction.T Spaces.Eye -&gt; Normal.T -&gt; Position3.T Spaces.Eye -&gt; LightSpherical.T -&gt; Specular.T -&gt; Color4.T -&gt; Vector3f.T
spherical view n surface_position light specular (Vector4f.V4 sr sg sb _) =
  let
    position_diff   = Position3.sub3 surface_position (LightSpherical.origin light)
    stl             = Vector3f.normalize (Vector3f.negation position_diff)
    distance        = Vector3f.magnitude (position_diff)
    attenuation     = Attenuation.attenuation (LightSpherical.radius light) (LightSpherical.falloff light) distance
    light_color     = LightSpherical.color light
    light_intensity = LightSpherical.intensity light
    light_d         = LightDiffuse.diffuse stl n light_color light_intensity
    light_s         = LightSpecular.specular stl view n light_color light_intensity specular
    light_da        = Vector3f.scale light_d attenuation
    light_sa        = Vector3f.scale light_s attenuation
    lit_d           = Vector3f.mult3 (Vector3f.V3 sr sg sb) light_da
    lit_s           = Vector3f.add3 lit_d light_sa
  in 
    lit_s
</pre></div></div><div class="st200_subsection_container"><div class="st200_subsection_title_number"><a id="st200_p2s20ss5" href="#st200_p2s20ss5">2.20.5</a></div><div class="st200_subsection_title">Shadows</div><div class="st200_paragraph_container"><div class="st200_paragraph_number"><a id="st200_p2s20ss5pg1" href="#st200_p2s20ss5pg1">1</a></div><div class="st200_paragraph">
      Spherical lights cannot project shadows. However, the
      <span class="st200_term package">io7m-r1</span> provides
      a so-called <a class="st200_link" href="p2s21.xhtml#st200_p2s21ss8">pseudo-spherical</a>
      lights implemented with six
      <a class="st200_link" href="p2s21.xhtml#st200_p2s21">projective</a> lights,
      each of which can project shadows.
    </div></div></div></div><div class="st200_navbar st200_navbar_bottom"><hr class="st200_hr"/><table class="st200_navbar_table" summary="Navigation bar"><tr><td class="st200_navbar_prev_file_cell"><a href="p2s19.xhtml#st200_p2s19">Previous</a></td><td class="st200_navbar_up_file_cell"><a href="p2.xhtml#st200_p2">Up</a></td><td class="st200_navbar_next_file_cell"><a href="p2s21.xhtml#st200_p2s21">Next</a></td></tr><tr><td class="st200_navbar_prev_title_cell">2.19. Directional Lighting</td><td class="st200_navbar_up_title_cell">2. Design and Implementation</td><td class="st200_navbar_next_title_cell">2.21. Projective Lighting</td></tr></table></div></div></body></html>
